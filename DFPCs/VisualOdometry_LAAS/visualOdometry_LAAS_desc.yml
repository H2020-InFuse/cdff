name: VisualOdometry_LAAS
doc: Visual odometry which relies on wheel odometry and stereo images developed by LAAS.
dfns:
    - name: StereoRectification
    - name: FeatAndSigExtractorLeft
    - name: FeatAndSigExtractorRight
    - name: FeatureMatching1
    - name: FeatureMatching2 #why the second DFN?
    - name: 3DPointTriangulation
    - name: 3D3DMotionEstimation

input_ports:
    - name: leftImage
      type: asn1SccFrame
      doc: "Left image frame"
      connections:
        - dfn: StereoRectification
          port: leftImage
    - name: rightImage
      type: asn1SccFrame
      doc: "Right image frame"
      connections:
        - dfn: StereoRectification
          port: rightImage

output_ports:
    - name: estimatedMotion
      type: asn1SccPose
      doc: "Pose estimated from the VisualOdometry_LAAS DFPC"
      connections:
          dfn: 3D3DMotionEstimation
          port: estimatedMotion

internal_connections:
    - from:
        dfn: StereoRectification
        port: leftImageRectified
      to:
        dfn: FeatAndSigExtractorLeft
        port: leftImage
    - from:
        dfn: StereoRectification
        port: rightImageRectified
      to:
        dfn: FeatAndSigExtractorRight
        port: rightImage
    - from:
        dfn: FeatAndSigExtractorLeft
        port: features
      to:
        dfn: FeatureMatching1
        port: leftFeatures
    - from:
        dfn: FeatAndSigExtractorRight
        port: features
      to:
        dfn: FeatureMatching1
        port: rightFeatures
    - from:
        dfn: FeatureMatching1
        port: leftMatchedFeatures
      to:
        dfn: 3DPointComputation
        port: leftMatchedFeatures
    - from:
        dfn: FeatureMatching1
        port: rightMatchedFeatures
      to:
        dfn: 3DPointComputation
        port: rightMatchedFeatures
    - from:
        dfn: 3DPointComputation
        port: 3DPoints
      to:
        dfn: 3D3DMotionEstimation
        port: curr3DPoints
    - from: #ask LAAS if this connection is correct?
        dfn: FeatureMatching1
        port: leftMatchedFeatures
      to:
        dfn: FeatureMatching2
        port: currMatchedFeatures

